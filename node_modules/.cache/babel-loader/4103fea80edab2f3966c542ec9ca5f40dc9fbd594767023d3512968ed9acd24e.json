{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.HttpRpcClient = void 0;\nconst ethers_1 = require(\"ethers\");\nconst utils_1 = require(\"ethers/lib/utils\");\nconst debug_1 = __importDefault(require(\"debug\"));\nconst utils_2 = require(\"@account-abstraction/utils\");\nconst debug = (0, debug_1.default)('aa.rpc');\nclass HttpRpcClient {\n  constructor(bundlerUrl, entryPointAddress, chainId) {\n    this.bundlerUrl = bundlerUrl;\n    this.entryPointAddress = entryPointAddress;\n    this.chainId = chainId;\n    this.userOpJsonRpcProvider = new ethers_1.ethers.providers.JsonRpcProvider(this.bundlerUrl, {\n      name: 'Connected bundler network',\n      chainId\n    });\n    this.initializing = this.validateChainId();\n  }\n  async validateChainId() {\n    // validate chainId is in sync with expected chainid\n    const chain = await this.userOpJsonRpcProvider.send('eth_chainId', []);\n    const bundlerChain = parseInt(chain);\n    if (bundlerChain !== this.chainId) {\n      throw new Error(`bundler ${this.bundlerUrl} is on chainId ${bundlerChain}, but provider is on chainId ${this.chainId}`);\n    }\n  }\n  /**\n   * send a UserOperation to the bundler\n   * @param userOp1\n   * @return userOpHash the id of this operation, for getUserOperationTransaction\n   */\n  async sendUserOpToBundler(userOp1) {\n    await this.initializing;\n    const hexifiedUserOp = (0, utils_2.deepHexlify)(await (0, utils_1.resolveProperties)(userOp1));\n    const jsonRequestData = [hexifiedUserOp, this.entryPointAddress];\n    await this.printUserOperation('eth_sendUserOperation', jsonRequestData);\n    return await this.userOpJsonRpcProvider.send('eth_sendUserOperation', [hexifiedUserOp, this.entryPointAddress]);\n  }\n  async estimateUserOpGas(userOp1) {\n    await this.initializing;\n    const hexifiedUserOp = (0, utils_2.deepHexlify)(await (0, utils_1.resolveProperties)(userOp1));\n    const jsonRequestData = [hexifiedUserOp, this.entryPointAddress];\n    await this.printUserOperation('eth_estimateUserOperationGas', jsonRequestData);\n    return await this.userOpJsonRpcProvider.send('eth_estimateUserOperationGas', [hexifiedUserOp, this.entryPointAddress]);\n  }\n  async printUserOperation(method, _ref) {\n    let [userOp1, entryPointAddress] = _ref;\n    const userOp = await (0, utils_1.resolveProperties)(userOp1);\n    debug('sending', method, Object.assign({}, userOp\n    // initCode: (userOp.initCode ?? '').length,\n    // callData: (userOp.callData ?? '').length\n    ), entryPointAddress);\n  }\n}\nexports.HttpRpcClient = HttpRpcClient;","map":{"version":3,"names":["ethers_1","require","utils_1","debug_1","__importDefault","utils_2","debug","default","HttpRpcClient","constructor","bundlerUrl","entryPointAddress","chainId","userOpJsonRpcProvider","ethers","providers","JsonRpcProvider","name","initializing","validateChainId","chain","send","bundlerChain","parseInt","Error","sendUserOpToBundler","userOp1","hexifiedUserOp","deepHexlify","resolveProperties","jsonRequestData","printUserOperation","estimateUserOpGas","method","_ref","userOp","Object","assign","exports"],"sources":["../../src/HttpRpcClient.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;AACA,MAAAA,QAAA,GAAAC,OAAA;AACA,MAAAC,OAAA,GAAAD,OAAA;AAEA,MAAAE,OAAA,GAAAC,eAAA,CAAAH,OAAA;AACA,MAAAI,OAAA,GAAAJ,OAAA;AAEA,MAAMK,KAAK,GAAG,IAAAH,OAAA,CAAAI,OAAK,EAAC,QAAQ,CAAC;AAE7B,MAAaC,aAAa;EAKxBC,YACWC,UAAkB,EAClBC,iBAAyB,EACzBC,OAAe;IAFf,KAAAF,UAAU,GAAVA,UAAU;IACV,KAAAC,iBAAiB,GAAjBA,iBAAiB;IACjB,KAAAC,OAAO,GAAPA,OAAO;IAEhB,IAAI,CAACC,qBAAqB,GAAG,IAAIb,QAAA,CAAAc,MAAM,CAACC,SAAS,CAACC,eAAe,CAAC,IAAI,CAACN,UAAU,EAAE;MACjFO,IAAI,EAAE,2BAA2B;MACjCL;KACD,CAAC;IACF,IAAI,CAACM,YAAY,GAAG,IAAI,CAACC,eAAe,EAAE;EAC5C;EAEA,MAAMA,eAAeA,CAAA;IACnB;IACA,MAAMC,KAAK,GAAG,MAAM,IAAI,CAACP,qBAAqB,CAACQ,IAAI,CAAC,aAAa,EAAE,EAAE,CAAC;IACtE,MAAMC,YAAY,GAAGC,QAAQ,CAACH,KAAK,CAAC;IACpC,IAAIE,YAAY,KAAK,IAAI,CAACV,OAAO,EAAE;MACjC,MAAM,IAAIY,KAAK,CAAC,WAAW,IAAI,CAACd,UAAU,kBAAkBY,YAAY,gCAAgC,IAAI,CAACV,OAAO,EAAE,CAAC;;EAE3H;EAEA;;;;;EAKA,MAAMa,mBAAmBA,CAAEC,OAA4B;IACrD,MAAM,IAAI,CAACR,YAAY;IACvB,MAAMS,cAAc,GAAG,IAAAtB,OAAA,CAAAuB,WAAW,EAAC,MAAM,IAAA1B,OAAA,CAAA2B,iBAAiB,EAACH,OAAO,CAAC,CAAC;IACpE,MAAMI,eAAe,GAAkC,CAACH,cAAc,EAAE,IAAI,CAAChB,iBAAiB,CAAC;IAC/F,MAAM,IAAI,CAACoB,kBAAkB,CAAC,uBAAuB,EAAED,eAAe,CAAC;IACvE,OAAO,MAAM,IAAI,CAACjB,qBAAqB,CACpCQ,IAAI,CAAC,uBAAuB,EAAE,CAACM,cAAc,EAAE,IAAI,CAAChB,iBAAiB,CAAC,CAAC;EAC5E;EAEA,MAAMqB,iBAAiBA,CAAEN,OAAqC;IAC5D,MAAM,IAAI,CAACR,YAAY;IACvB,MAAMS,cAAc,GAAG,IAAAtB,OAAA,CAAAuB,WAAW,EAAC,MAAM,IAAA1B,OAAA,CAAA2B,iBAAiB,EAACH,OAAO,CAAC,CAAC;IACpE,MAAMI,eAAe,GAAkC,CAACH,cAAc,EAAE,IAAI,CAAChB,iBAAiB,CAAC;IAC/F,MAAM,IAAI,CAACoB,kBAAkB,CAAC,8BAA8B,EAAED,eAAe,CAAC;IAC9E,OAAO,MAAM,IAAI,CAACjB,qBAAqB,CACpCQ,IAAI,CAAC,8BAA8B,EAAE,CAACM,cAAc,EAAE,IAAI,CAAChB,iBAAiB,CAAC,CAAC;EACnF;EAEQ,MAAMoB,kBAAkBA,CAAEE,MAAc,EAAAC,IAAA,EAA6D;IAAA,IAA3D,CAACR,OAAO,EAAEf,iBAAiB,CAAgC,GAAAuB,IAAA;IAC3G,MAAMC,MAAM,GAAG,MAAM,IAAAjC,OAAA,CAAA2B,iBAAiB,EAACH,OAAO,CAAC;IAC/CpB,KAAK,CAAC,SAAS,EAAE2B,MAAM,EAAAG,MAAA,CAAAC,MAAA,KAClBF;IACH;IACA;IAAA,C,EACCxB,iBAAiB,CAAC;EACvB;;AAxDF2B,OAAA,CAAA9B,aAAA,GAAAA,aAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}